<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç´ æä¸€è¦§ - ã‚„ã¾ã•ã‚“ã®ãƒ•ãƒªãƒ¼ç´ æå±‹</title>
  <meta name="description" content="ã‚„ã¾ã•ã‚“ã®ãƒ•ãƒªãƒ¼ç´ æå±‹ã®å…¨ç´ æä¸€è¦§ã€‚ã‚«ãƒ†ã‚´ãƒªã‚„ã‚¿ã‚°ã§æ¤œç´¢ãƒ»çµã‚Šè¾¼ã¿ãŒã§ãã¾ã™ã€‚">
  <meta name="keywords" content="ãƒ•ãƒªãƒ¼ç´ æ,ç„¡æ–™,ç”»åƒ,ã‚¤ãƒ©ã‚¹ãƒˆ,èƒŒæ™¯,UI,ãƒ‘ã‚¿ãƒ¼ãƒ³,æ¤œç´¢">
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  
  <style>
    .card-item {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      cursor: pointer;
      height: 100%;
    }
    .card-item:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    .card-item img {
      height: 200px;
      object-fit: cover;
    }
    .tag-item {
      cursor: pointer;
      user-select: none;
      transition: all 0.2s ease;
    }
    .tag-item:hover {
      transform: scale(1.05);
    }
    .tag-item.active {
      background-color: #0d6efd !important;
      color: white !important;
      border-color: #0d6efd !important;
    }
    .result-info {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
    }
    .search-header {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
    }
  </style>
</head>
<body>

<!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand fw-bold" href="index.html">
      <i class="bi bi-images"></i> ã‚„ã¾ã•ã‚“ã®ãƒ•ãƒªãƒ¼ç´ æå±‹
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item">
          <a class="nav-link" href="index.html">ğŸ  ãƒ›ãƒ¼ãƒ </a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="list.html">ğŸ“‹ ç´ æä¸€è¦§</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="tags.html">ğŸ·ï¸ ã‚¿ã‚°ä¸€è¦§</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- ãƒšãƒ¼ã‚¸ãƒ˜ãƒƒãƒ€ãƒ¼ -->
<section class="search-header py-5">
  <div class="container text-center">
    <h1 class="display-5 fw-bold mb-3">
      <i class="bi bi-search"></i> ç´ æã‚’æ¢ã™
    </h1>
    <p class="lead mb-0">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€ã‚«ãƒ†ã‚´ãƒªã€ã‚¿ã‚°ã§çµã‚Šè¾¼ã‚“ã§ç†æƒ³ã®ç´ æã‚’è¦‹ã¤ã‘ã‚ˆã†</p>
  </div>
</section>

<!-- çµ±è¨ˆæƒ…å ± -->
<section class="py-4 bg-light">
  <div class="container">
    <div class="row text-center">
      <div class="col-md-3">
        <div class="h4 fw-bold text-primary" id="totalItems">-</div>
        <div class="text-muted">ç·ç´ ææ•°</div>
      </div>
      <div class="col-md-3">
        <div class="h4 fw-bold text-primary" id="totalCategories">-</div>
        <div class="text-muted">ã‚«ãƒ†ã‚´ãƒª</div>
      </div>
      <div class="col-md-3">
        <div class="h4 fw-bold text-primary" id="totalTags">-</div>
        <div class="text-muted">ã‚¿ã‚°</div>
      </div>
      <div class="col-md-3">
        <div class="h4 fw-bold text-primary">CC0</div>
        <div class="text-muted">ãƒ©ã‚¤ã‚»ãƒ³ã‚¹</div>
      </div>
    </div>
  </div>
</section>

<!-- æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
<section class="py-4 border-bottom">
  <div class="container">
    <div class="row g-3 mb-4">
      <div class="col-md-4">
        <label class="form-label fw-semibold">ğŸ” ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢</label>
        <input id="q" type="search" class="form-control" placeholder="ä¾‹ï¼šsky, ui, grass">
      </div>
      <div class="col-md-3">
        <label class="form-label fw-semibold">ğŸ“ ã‚«ãƒ†ã‚´ãƒª</label>
        <select id="cat" class="form-select">
          <option value="">ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒª</option>
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label fw-semibold">ğŸ“Š ä¸¦ã³æ›¿ãˆ</label>
        <select id="sort" class="form-select">
          <option value="title">ã‚¿ã‚¤ãƒˆãƒ«é †</option>
          <option value="wdesc">ã‚µã‚¤ã‚ºå¤§â†’å°</option>
          <option value="wasc">ã‚µã‚¤ã‚ºå°â†’å¤§</option>
        </select>
      </div>
      <div class="col-md-2">
        <label class="form-label fw-semibold">ğŸ·ï¸ ã‚¿ã‚°</label>
        <button id="clearTags" class="btn btn-outline-danger w-100" title="é¸æŠä¸­ã®ã‚¿ã‚°ã‚’ã‚¯ãƒªã‚¢">
          ã‚¯ãƒªã‚¢
        </button>
      </div>
    </div>
    
    <!-- ã‚¿ã‚°ã‚¯ãƒ©ã‚¦ãƒ‰ -->
    <div class="card">
      <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
          <h6 class="mb-0 fw-semibold">ğŸ·ï¸ ã‚¿ã‚°ã§çµã‚Šè¾¼ã¿</h6>
          <div class="d-flex gap-2 align-items-center">
            <small id="tagStats" class="text-muted"></small>
            <a href="tags.html" class="btn btn-outline-secondary btn-sm">
              ã™ã¹ã¦ã®ã‚¿ã‚°ã‚’è¦‹ã‚‹
            </a>
          </div>
        </div>
      </div>
      <div class="card-body">
        <div id="tagbar" class="d-flex flex-wrap gap-2"></div>
        <div id="selectedTags" class="mt-3 p-2 bg-light rounded" style="display: none;">
          <small class="text-muted fw-semibold">é¸æŠä¸­ã®ã‚¿ã‚°ï¼š</small>
          <div id="selectedTagsList" class="d-inline-flex flex-wrap gap-1 ms-2"></div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- æ¤œç´¢çµæœ -->
<main class="py-4">
  <div class="container">
    <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
    <div id="resultInfo" class="alert result-info mb-4" style="display: none;">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <i class="bi bi-info-circle"></i>
          <span id="resultText"></span>
        </div>
        <button class="btn btn-outline-light btn-sm" onclick="clearAllFilters()">
          <i class="bi bi-arrow-clockwise"></i> ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ã‚¯ãƒªã‚¢
        </button>
      </div>
    </div>
    
    <!-- ç´ æã‚°ãƒªãƒƒãƒ‰ -->
    <div id="grid" class="row g-3"></div>
    
    <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
    <nav id="pagination" class="mt-4" style="display: none;">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div class="d-flex align-items-center gap-2">
          <label class="form-label mb-0">è¡¨ç¤ºä»¶æ•°ï¼š</label>
          <select id="itemsPerPageSelect" class="form-select form-select-sm" style="width: auto;">
            <option value="12">12ä»¶</option>
            <option value="24" selected>24ä»¶</option>
            <option value="48">48ä»¶</option>
            <option value="96">96ä»¶</option>
          </select>
        </div>
        <small class="text-muted" id="pageInfo"></small>
      </div>
      <ul class="pagination justify-content-center" id="paginationList">
        <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ãŒã“ã“ã«å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
      </ul>
    </nav>
    
    <!-- æ¤œç´¢çµæœãªã—ã®å ´åˆ -->
    <div id="noResults" class="text-center py-5" style="display: none;">
      <div class="mb-4">
        <i class="bi bi-search text-muted" style="font-size: 4rem;"></i>
      </div>
      <h3 class="text-muted mb-3">æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</h3>
      <p class="text-muted mb-4">åˆ¥ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚„ã‚«ãƒ†ã‚´ãƒªã§æ¤œç´¢ã—ã¦ã¿ã¦ãã ã•ã„</p>
      <button class="btn btn-primary" onclick="clearAllFilters()">
        <i class="bi bi-arrow-clockwise"></i> ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ã‚¯ãƒªã‚¢
      </button>
    </div>
  </div>
</main>

<footer class="bg-dark text-white py-4 mt-5">
  <div class="container">
    <div class="row">
      <div class="col-md-4">
        <h5>ã‚„ã¾ã•ã‚“ã®ãƒ•ãƒªãƒ¼ç´ æå±‹</h5>
        <p class="small mb-0">ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼å‘ã‘ã®ãƒ•ãƒªãƒ¼ç”»åƒç´ æã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚</p>
      </div>
      <div class="col-md-4">
        <h6>ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h6>
        <ul class="list-unstyled">
          <li><a href="index.html" class="text-light text-decoration-none small">ãƒ›ãƒ¼ãƒ </a></li>
          <li><a href="list.html" class="text-light text-decoration-none small">ç´ æä¸€è¦§</a></li>
          <li><a href="tags.html" class="text-light text-decoration-none small">ã‚¿ã‚°ä¸€è¦§</a></li>
        </ul>
      </div>
      <div class="col-md-4">
        <h6>äººæ°—ã‚¿ã‚°</h6>
        <div id="footerTags" class="d-flex flex-wrap gap-1">
          <!-- äººæ°—ã‚¿ã‚°ãŒã“ã“ã«å‹•çš„ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
        </div>
      </div>
    </div>
    <hr>
    <div class="text-center">
      <small>&copy; ã‚„ã¾ã•ã‚“ã®ãƒ•ãƒªãƒ¼ç´ æå±‹ï½œç„¡æ–™ã®èƒŒæ™¯ã‚¤ãƒ©ã‚¹ãƒˆ. All rights reserved.</small>
    </div>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
let allItems = [];
let filteredItems = [];
let selectedTags = new Set();

// ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
let currentPage = 1;
let itemsPerPage = 24; // 1ãƒšãƒ¼ã‚¸ã‚ãŸã‚Šã®è¡¨ç¤ºæ•°
let totalPages = 0;

// å…¨ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ã‚¯ãƒªã‚¢
function clearAllFilters() {
  document.getElementById("q").value = "";
  document.getElementById("cat").value = "";
  document.getElementById("sort").value = "title";
  selectedTags.clear();
  updateSelectedTagsDisplay();
  currentPage = 1; // ãƒšãƒ¼ã‚¸ã‚‚ãƒªã‚»ãƒƒãƒˆ
  performSearch();
}

// ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°
function updatePagination() {
  totalPages = Math.ceil(filteredItems.length / itemsPerPage);
  const pagination = document.getElementById("pagination");
  const paginationList = document.getElementById("paginationList");
  const pageInfo = document.getElementById("pageInfo");
  
  if (totalPages <= 1) {
    pagination.style.display = "none";
    return;
  }
  
  pagination.style.display = "block";
  
  // ãƒšãƒ¼ã‚¸æƒ…å ±
  const start = (currentPage - 1) * itemsPerPage + 1;
  const end = Math.min(currentPage * itemsPerPage, filteredItems.length);
  pageInfo.textContent = `${start}-${end}ä»¶ç›® (å…¨${filteredItems.length}ä»¶)`;
  
  // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ç”Ÿæˆ
  paginationList.innerHTML = "";
  
  // å‰ã¸ãƒœã‚¿ãƒ³
  const prevLi = document.createElement("li");
  prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
  prevLi.innerHTML = `<a class="page-link" href="#" onclick="goToPage(${currentPage - 1})">å‰ã¸</a>`;
  paginationList.appendChild(prevLi);
  
  // ãƒšãƒ¼ã‚¸ç•ªå·ãƒœã‚¿ãƒ³
  const startPage = Math.max(1, currentPage - 2);
  const endPage = Math.min(totalPages, currentPage + 2);
  
  if (startPage > 1) {
    const firstLi = document.createElement("li");
    firstLi.className = "page-item";
    firstLi.innerHTML = `<a class="page-link" href="#" onclick="goToPage(1)">1</a>`;
    paginationList.appendChild(firstLi);
    
    if (startPage > 2) {
      const ellipsisLi = document.createElement("li");
      ellipsisLi.className = "page-item disabled";
      ellipsisLi.innerHTML = `<span class="page-link">...</span>`;
      paginationList.appendChild(ellipsisLi);
    }
  }
  
  for (let i = startPage; i <= endPage; i++) {
    const li = document.createElement("li");
    li.className = `page-item ${i === currentPage ? 'active' : ''}`;
    li.innerHTML = `<a class="page-link" href="#" onclick="goToPage(${i})">${i}</a>`;
    paginationList.appendChild(li);
  }
  
  if (endPage < totalPages) {
    if (endPage < totalPages - 1) {
      const ellipsisLi = document.createElement("li");
      ellipsisLi.className = "page-item disabled";
      ellipsisLi.innerHTML = `<span class="page-link">...</span>`;
      paginationList.appendChild(ellipsisLi);
    }
    
    const lastLi = document.createElement("li");
    lastLi.className = "page-item";
    lastLi.innerHTML = `<a class="page-link" href="#" onclick="goToPage(${totalPages})">${totalPages}</a>`;
    paginationList.appendChild(lastLi);
  }
  
  // æ¬¡ã¸ãƒœã‚¿ãƒ³
  const nextLi = document.createElement("li");
  nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
  nextLi.innerHTML = `<a class="page-link" href="#" onclick="goToPage(${currentPage + 1})">æ¬¡ã¸</a>`;
  paginationList.appendChild(nextLi);
}

function goToPage(page) {
  if (page < 1 || page > totalPages) return;
  currentPage = page;
  displayResults();
  
  // ãƒšãƒ¼ã‚¸ç§»å‹•æ™‚ã«ä¸Šéƒ¨ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
  document.querySelector('#resultInfo').scrollIntoView({ 
    behavior: 'smooth',
    block: 'start'
  });
}

function changeItemsPerPage() {
  itemsPerPage = parseInt(document.getElementById("itemsPerPageSelect").value);
  currentPage = 1;
  displayResults();
}

// é¸æŠä¸­ã‚¿ã‚°ã®è¡¨ç¤ºæ›´æ–°
function updateSelectedTagsDisplay() {
  const container = document.getElementById("selectedTags");
  const list = document.getElementById("selectedTagsList");
  
  if (selectedTags.size === 0) {
    container.style.display = "none";
    return;
  }
  
  container.style.display = "block";
  list.innerHTML = "";
  
  selectedTags.forEach(tag => {
    const span = document.createElement("span");
    span.className = "badge bg-primary me-1";
    span.innerHTML = `${tag} <i class="bi bi-x" onclick="removeTag('${tag}')" style="cursor: pointer;"></i>`;
    list.appendChild(span);
  });
}

// ã‚¿ã‚°å‰Šé™¤
function removeTag(tag) {
  selectedTags.delete(tag);
  updateSelectedTagsDisplay();
  updateTagButtons();
  performSearch();
}

// ã‚¿ã‚°ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
function updateTagButtons() {
  document.querySelectorAll(".tag-item").forEach(btn => {
    const tag = btn.textContent.trim();
    if (selectedTags.has(tag)) {
      btn.classList.add("active");
    } else {
      btn.classList.remove("active");
    }
  });
}

// ç´ æã‚«ãƒ¼ãƒ‰ä½œæˆ
function createCard(item) {
  return `
    <div class="col-lg-3 col-md-4 col-sm-6">
      <div class="card card-item h-100" onclick="window.open('items/${item.slug}/', '_blank')">
        <img src="${item.thumb}" class="card-img-top" alt="${item.title}" loading="lazy">
        <div class="card-body">
          <h6 class="card-title">${item.title}</h6>
          <div class="d-flex justify-content-between align-items-center">
            <small class="text-muted">
              <i class="bi bi-folder"></i> ${item.category}
            </small>
            <small class="text-muted">
              ${item.width}Ã—${item.height}
            </small>
          </div>
          <div class="mt-2">
            ${item.tags.slice(0, 3).map(tag => 
              `<span class="badge bg-light text-dark me-1" style="font-size: 0.7em;">${tag}</span>`
            ).join('')}
            ${item.tags.length > 3 ? '<span class="text-muted" style="font-size: 0.7em;">...</span>' : ''}
          </div>
        </div>
      </div>
    </div>
  `;
}

// æ¤œç´¢å®Ÿè¡Œ
function performSearch() {
  const query = document.getElementById("q").value.toLowerCase();
  const category = document.getElementById("cat").value;
  const sort = document.getElementById("sort").value;
  
  // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
  filteredItems = allItems.filter(item => {
    // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢
    if (query && !item.title.toLowerCase().includes(query) && 
        !item.tags.some(tag => tag.toLowerCase().includes(query))) {
      return false;
    }
    
    // ã‚«ãƒ†ã‚´ãƒªæ¤œç´¢
    if (category && item.category !== category) {
      return false;
    }
    
    // ã‚¿ã‚°æ¤œç´¢
    if (selectedTags.size > 0) {
      const hasAllTags = Array.from(selectedTags).every(tag => 
        item.tags.includes(tag)
      );
      if (!hasAllTags) return false;
    }
    
    return true;
  });
  
  // ã‚½ãƒ¼ãƒˆ
  filteredItems.sort((a, b) => {
    switch (sort) {
      case "wdesc": return b.width - a.width;
      case "wasc": return a.width - b.width;
      default: return a.title.localeCompare(b.title);
    }
  });
  
  // æ¤œç´¢æ¡ä»¶ãŒå¤‰ã‚ã£ãŸã‚‰ãƒšãƒ¼ã‚¸ã‚’ãƒªã‚»ãƒƒãƒˆ
  currentPage = 1;
  
  // çµæœè¡¨ç¤º
  displayResults();
}

// çµæœè¡¨ç¤º
function displayResults() {
  const grid = document.getElementById("grid");
  const resultInfo = document.getElementById("resultInfo");
  const resultText = document.getElementById("resultText");
  const noResults = document.getElementById("noResults");
  
  if (filteredItems.length === 0) {
    grid.innerHTML = "";
    resultInfo.style.display = "none";
    noResults.style.display = "block";
    document.getElementById("pagination").style.display = "none";
    return;
  }
  
  noResults.style.display = "none";
  resultInfo.style.display = "block";
  
  // çµæœæƒ…å ±
  const total = allItems.length;
  const current = filteredItems.length;
  
  if (current === total) {
    resultText.textContent = `å…¨ ${total} ä»¶ã®ç´ æã‚’è¡¨ç¤ºä¸­`;
  } else {
    resultText.textContent = `${total} ä»¶ä¸­ ${current} ä»¶ã‚’è¡¨ç¤ºä¸­`;
  }
  
  // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³è¨ˆç®—
  const startIndex = (currentPage - 1) * itemsPerPage;
  const endIndex = Math.min(startIndex + itemsPerPage, filteredItems.length);
  const pageItems = filteredItems.slice(startIndex, endIndex);
  
  // ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤ºï¼ˆç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã®åˆ†ã®ã¿ï¼‰
  grid.innerHTML = pageItems.map(createCard).join("");
  
  // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°
  updatePagination();
}

// åˆæœŸåŒ–
(async function(){
  try {
    const res = await fetch("assets.json");
    const data = await res.json();
    allItems = data.items || [];

    // thumbnailPathã‚’thumbãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦è¨­å®š
    allItems = allItems.map(item => ({
      ...item,
      thumb: item.thumbnailPath
    }));

    filteredItems = [...allItems];

    const cats = Array.from(new Set(allItems.map(x => x.category))).sort();
    const tags = Array.from(new Set(allItems.flatMap(x => x.tags))).sort();

    // çµ±è¨ˆæƒ…å ±
    document.getElementById("totalItems").textContent = allItems.length;
    document.getElementById("totalCategories").textContent = cats.length;
    document.getElementById("totalTags").textContent = tags.length;

    // ã‚«ãƒ†ã‚´ãƒªé¸æŠè‚¢
    const catSelect = document.getElementById("cat");
    cats.forEach(cat => {
      const option = document.createElement("option");
      option.value = cat;
      option.textContent = cat;
      catSelect.appendChild(option);
    });

    // ã‚¿ã‚°ã®ä½¿ç”¨é »åº¦ã‚’è¨ˆç®—
    const tagFreq = {};
    allItems.forEach(item => {
      item.tags.forEach(tag => {
        tagFreq[tag] = (tagFreq[tag] || 0) + 1;
      });
    });

    // ã‚¿ã‚°ã‚¯ãƒ©ã‚¦ãƒ‰
    const tagbar = document.getElementById("tagbar");
    tags.forEach(tag => {
      const freq = tagFreq[tag];
      const btn = document.createElement("button");
      btn.className = "btn btn-outline-secondary tag-item me-2 mb-2";
      btn.textContent = tag;
      btn.onclick = () => {
        if (selectedTags.has(tag)) {
          selectedTags.delete(tag);
        } else {
          selectedTags.add(tag);
        }
        updateSelectedTagsDisplay();
        updateTagButtons();
        performSearch();
      };
      tagbar.appendChild(btn);
    });

    // ãƒ•ãƒƒã‚¿ãƒ¼ã‚¿ã‚° (äººæ°—é †)
    const footerTags = document.getElementById("footerTags");
    const popularTags = Object.entries(tagFreq)
      .sort((a, b) => b[1] - a[1])
      .slice(0, 8);
    
    popularTags.forEach(([tag, count]) => {
      const span = document.createElement("span");
      span.className = "badge bg-secondary me-1 mb-1";
      span.textContent = tag;
      span.style.cursor = "pointer";
      span.onclick = () => {
        document.getElementById("q").value = tag;
        performSearch();
      };
      footerTags.appendChild(span);
    });

    // ã‚¿ã‚°çµ±è¨ˆ
    document.getElementById("tagStats").textContent = `${tags.length}å€‹ã®ã‚¿ã‚°`;

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    document.getElementById("q").addEventListener("input", performSearch);
    document.getElementById("cat").addEventListener("change", performSearch);
    document.getElementById("sort").addEventListener("change", performSearch);
    document.getElementById("itemsPerPageSelect").addEventListener("change", changeItemsPerPage);
    document.getElementById("clearTags").addEventListener("click", () => {
      selectedTags.clear();
      updateSelectedTagsDisplay();
      updateTagButtons();
      performSearch();
    });

    // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰æ¤œç´¢ã‚¯ã‚¨ãƒªã‚’å–å¾—
    const urlParams = new URLSearchParams(window.location.search);
    const searchQuery = urlParams.get('q');
    if (searchQuery) {
      document.getElementById("q").value = searchQuery;
    }

    // åˆæœŸè¡¨ç¤º
    performSearch();
    
  } catch (error) {
    console.error("ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:", error);
    document.getElementById("grid").innerHTML = '<div class="col-12 text-center"><p class="text-danger">ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p></div>';
  }
})();
</script>

</body>
</html>
