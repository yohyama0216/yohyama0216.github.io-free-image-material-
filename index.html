<!-- index.html（差分のポイント：カードが detail へ飛ぶ・DLボタンは削除） -->
<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Free Game Materials</title>
  <meta name="description" content="ゲーム向けのフリー画像素材集">
  <link rel="icon" href="data:," />
  <style>
    :root { --max:1200px; --gap:12px; }
    body { margin:0; font:16px/1.6 system-ui,-apple-system,"Segoe UI",sans-serif; }
    header { border-bottom:1px solid #eee; }
    .wrap { max-width:var(--max); margin:auto; padding:16px; }
    h1 { font-size:22px; margin:0 0 8px; }
    .controls { display:flex; gap:8px; flex-wrap:wrap; margin:8px 0 16px; }
    input[type="search"], select { padding:8px; border:1px solid #ddd; border-radius:8px; min-width:200px; }
    .tags { display:flex; gap:8px; flex-wrap:wrap; margin:8px 0; }
    .tag { padding:6px 10px; border:1px solid #ddd; border-radius:999px; cursor:pointer; user-select:none; font-size:14px; }
    .tag.active { background:#f0f0f0; }
    .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(220px,1fr)); gap:var(--gap); }
    .card { border:1px solid #eee; border-radius:12px; overflow:hidden; background:#fff; display:flex; flex-direction:column; text-decoration:none; color:inherit; }
    .thumb { aspect-ratio: 16/9; object-fit:cover; width:100%; display:block; }
    .meta { padding:10px; display:flex; flex-direction:column; gap:6px; }
    .meta small { color:#666; }
    footer { border-top:1px solid #eee; margin-top:20px; }
  </style>
</head>
<body>
<header><div class="wrap">
  <h1>Free Game Materials</h1>
  <div class="controls">
    <input id="q" type="search" placeholder="キーワード検索（例：sky, ui, grass）">
    <select id="cat"><option value="">すべてのカテゴリ</option></select>
    <select id="sort">
      <option value="title">並び替え：タイトル</option>
      <option value="wdesc">並び替え：横幅（大→小）</option>
      <option value="wasc">並び替え：横幅（小→大）</option>
    </select>
  </div>
  <div id="tagbar" class="tags"></div>
</div></header>

<main><div class="wrap">
  <div id="grid" class="grid"></div>
</div></main>

<footer><div class="wrap">
  <small>© 2025 Free Game Materials</small>
</div></footer>

<script>
(async function(){
  const res = await fetch("assets.json");
  const data = await res.json();
  let items = data.items || [];

  const cats = Array.from(new Set(items.map(x => x.category))).sort();
  const tags = Array.from(new Set(items.flatMap(x => x.tags))).sort();

  const catSel = document.getElementById("cat");
  cats.forEach(c => { const o=document.createElement("option"); o.value=c; o.textContent=c; catSel.appendChild(o); });

  const tagbar = document.getElementById("tagbar");
  const activeTags = new Set();
  tags.forEach(t => {
    const b=document.createElement("button");
    b.type="button"; b.className="tag"; b.textContent=t;
    b.onclick=()=>{ b.classList.toggle("active"); activeTags.has(t)?activeTags.delete(t):activeTags.add(t); render(); };
    tagbar.appendChild(b);
  });

  const q = document.getElementById("q");
  const sortSel = document.getElementById("sort");
  q.addEventListener("input", render);
  catSel.addEventListener("change", render);
  sortSel.addEventListener("change", render);

  function sortItems(arr){
    const v = sortSel.value;
    if (v === "wdesc") return arr.sort((a,b) => (b.width||0)-(a.width||0));
    if (v === "wasc") return arr.sort((a,b) => (a.width||0)-(b.width||0));
    return arr.sort((a,b) => a.title.localeCompare(b.title));
  }

  function match(x){
    const kw = q.value.trim().toLowerCase();
    const kwok = !kw || [x.title, x.category, ...(x.tags||[])].join(" ").toLowerCase().includes(kw);
    const catok = !catSel.value || x.category === catSel.value;
    const tagok = activeTags.size===0 || [...activeTags].every(t => x.tags.includes(t));
    return kwok && catok && tagok;
  }

  function card(t){
    const a = document.createElement("a");
    a.className = "card";
    a.href = `items/${t.slug}/`;     // ← 詳細ページへ
    a.innerHTML = `
      <img class="thumb" loading="lazy" src="${t.thumb}" alt="${t.title}">
      <div class="meta">
        <strong>${t.title}</strong>
        <small>${t.category} · ${t.tags.join(", ")}</small>
        <small>${t.width || "?"}×${t.height || "?"} · ${t.license}</small>
      </div>`;
    return a;
  }

  function render(){
    const grid = document.getElementById("grid");
    grid.innerHTML = "";
    sortItems(items.filter(match)).forEach(x => grid.appendChild(card(x)));
  }
  render();
})();
</script>
</body>
</html>
