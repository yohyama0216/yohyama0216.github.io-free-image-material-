<!-- index.html - トップページ専用 -->
<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>フリー画像素材集 | ゲーム開発向け高品質素材</title>
  <meta name="description" content="ゲーム開発に最適なフリー画像素材集。UI、背景、キャラクターなど豊富なカテゴリの高品質素材を無料で提供。商用利用可能で即ダウンロード可能です。">
  <meta name="keywords" content="フリー素材,ゲーム素材,画像素材,UI素材,背景素材,無料ダウンロード,商用利用可能">
  <meta name="author" content="Free Game Materials">
  <meta property="og:title" content="フリー画像素材集 | ゲーム開発向け高品質素材">
  <meta property="og:description" content="ゲーム開発に最適なフリー画像素材集。UI、背景、キャラクターなど豊富なカテゴリの高品質素材を無料で提供。">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://yohyama0216.github.io/free-image-material/">
  <meta property="og:image" content="https://yohyama0216.github.io/free-image-material/assets/og-image.jpg">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="フリー画像素材集 | ゲーム開発向け高品質素材">
  <meta name="twitter:description" content="ゲーム開発に最適なフリー画像素材集。UI、背景、キャラクターなど豊富なカテゴリの高品質素材を無料で提供。">
  <meta name="twitter:image" content="https://yohyama0216.github.io/free-image-material/assets/og-image.jpg">
  <link rel="canonical" href="https://yohyama0216.github.io/free-image-material/">
  <link rel="icon" href="data:," />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>
<body>
<!-- ヒーローセクション -->
<section class="bg-primary text-white py-5">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-6">
        <h1 class="display-4 fw-bold mb-3">Free Game Materials</h1>
        <p class="lead mb-4">ゲーム開発に最適なフリー画像素材集。UI、背景、キャラクターなど豊富なカテゴリの高品質素材を無料で提供。商用利用可能で即ダウンロード可能です。</p>
        <div class="d-flex gap-3">
          <span class="badge bg-light text-dark px-3 py-2">商用利用OK</span>
          <span class="badge bg-light text-dark px-3 py-2">高品質</span>
          <span class="badge bg-light text-dark px-3 py-2">即ダウンロード</span>
        </div>
      </div>
      <div class="col-lg-6 text-center">
        <div class="bg-white bg-opacity-10 rounded p-4">
          <h3 class="h5 mb-3">🎮 素材を探す</h3>
          <div class="input-group mb-3">
            <input id="heroSearch" type="search" class="form-control" placeholder="キーワードで検索...">
            <button class="btn btn-light" type="button" onclick="performHeroSearch()">
              <i class="bi bi-search"></i> 検索
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- 統計情報 -->
<section class="py-4 bg-light">
  <div class="container">
    <div class="row text-center">
      <div class="col-md-3">
        <div class="h4 fw-bold text-primary" id="totalItems">-</div>
        <div class="text-muted">総素材数</div>
      </div>
      <div class="col-md-3">
        <div class="h4 fw-bold text-primary" id="totalCategories">-</div>
        <div class="text-muted">カテゴリ</div>
      </div>
      <div class="col-md-3">
        <div class="h4 fw-bold text-primary" id="totalTags">-</div>
        <div class="text-muted">タグ</div>
      </div>
      <div class="col-md-3">
        <div class="h4 fw-bold text-primary">CC0</div>
        <div class="text-muted">ライセンス</div>
      </div>
    </div>
  </div>
</section>

<!-- 新着素材 -->
<section class="py-5">
  <div class="container">
    <div class="text-center mb-4">
      <h2 class="h3 fw-bold">🆕 新着素材</h2>
      <p class="text-muted">最近追加された素材をチェック！</p>
    </div>
    
    <div id="latestItems" class="row g-4 mb-4">
      <!-- 新着素材が動的に表示される -->
    </div>
    
    <div class="text-center">
      <button onclick="scrollToSearch()" class="btn btn-outline-primary btn-lg">
        すべての素材を見る →
      </button>
    </div>
  </div>
</section>

<!-- 検索・フィルター -->
<section class="py-4 border-bottom">
  <div class="container">
    <div class="row g-3 mb-4">
      <div class="col-md-4">
        <label class="form-label fw-semibold">🔍 キーワード検索</label>
        <input id="q" type="search" class="form-control" placeholder="例：sky, ui, grass">
      </div>
      <div class="col-md-3">
        <label class="form-label fw-semibold">📁 カテゴリ</label>
        <select id="cat" class="form-select">
          <option value="">すべてのカテゴリ</option>
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label fw-semibold">📊 並び替え</label>
        <select id="sort" class="form-select">
          <option value="title">タイトル順</option>
          <option value="wdesc">サイズ大→小</option>
          <option value="wasc">サイズ小→大</option>
        </select>
      </div>
      <div class="col-md-2">
        <label class="form-label fw-semibold">🏷️ タグ</label>
        <button id="clearTags" class="btn btn-outline-danger w-100" title="選択中のタグをクリア">
          クリア
        </button>
      </div>
    </div>
    <!-- タグクラウド -->
    <div class="card">
      <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
          <h6 class="mb-0 fw-semibold">🏷️ タグで絞り込み</h6>
          <div class="d-flex gap-2 align-items-center">
            <small id="tagStats" class="text-muted"></small>
            <a href="tags.html" class="btn btn-outline-secondary btn-sm">
              すべてのタグを見る
            </a>
          </div>
        </div>
      </div>
      <div class="card-body">
        <div id="tagbar" class="d-flex flex-wrap gap-2"></div>
        <div id="selectedTags" class="mt-3 p-2 bg-light rounded" style="display: none;">
          <small class="text-muted fw-semibold">選択中のタグ：</small>
          <div id="selectedTagsList" class="d-inline-flex flex-wrap gap-1 ms-2"></div>
        </div>
      </div>
    </div>
  </div>
</section>

<main class="py-4">
  <div class="container">
    <!-- 結果表示エリア -->
    <div id="resultInfo" class="alert alert-info mb-4" style="display: none;"></div>
    
    <!-- 素材グリッド -->
    <div id="grid" class="row g-3"></div>
  </div>
</main>

<footer class="bg-dark text-white py-4 mt-5">
  <div class="container">
    <div class="row">
      <div class="col-md-4">
        <h5>Free Game Materials</h5>
        <p class="text-muted">ゲーム開発に最適なフリー素材を提供しています。</p>
      </div>
      <div class="col-md-2">
        <h6>ナビゲーション</h6>
        <ul class="list-unstyled">
          <li><a href="./" class="text-light text-decoration-none">素材一覧</a></li>
          <li><a href="tags.html" class="text-light text-decoration-none">タグ一覧</a></li>
        </ul>
      </div>
      <div class="col-md-3">
        <h6>カテゴリ</h6>
        <div id="footerCategories" class="d-flex flex-wrap gap-1">
          <!-- カテゴリがここに動的に追加される -->
        </div>
      </div>
      <div class="col-md-3">
        <h6>利用について</h6>
        <ul class="list-unstyled">
          <li><small>✓ 商用利用可能</small></li>
          <li><small>✓ クレジット不要</small></li>
          <li><small>✓ 加工・改変OK</small></li>
        </ul>
      </div>
    </div>
    <hr class="my-3">
    
    <!-- タグ一覧セクション -->
    <div class="row mb-4">
      <div class="col-12">
        <h6 class="text-white mb-3">🏷️ すべてのタグ</h6>
        <div id="footerTags" class="d-flex flex-wrap gap-2">
          <!-- タグがここに動的に追加される -->
        </div>
      </div>
    </div>
    
    <div class="text-center">
      <small class="text-muted">© 2025 Free Game Materials. All rights reserved.</small>
    </div>
  </div>
</footer>

<script>
// ヒーロー検索機能
function performHeroSearch() {
  const heroInput = document.getElementById("heroSearch");
  const mainInput = document.getElementById("q");
  mainInput.value = heroInput.value;
  
  // 検索セクションまでスクロール
  document.querySelector('main').scrollIntoView({ behavior: 'smooth' });
  
  // 検索を実行
  render();
}

// 検索セクションまでスクロール
function scrollToSearch() {
  document.querySelector('main').scrollIntoView({ behavior: 'smooth' });
}

// 新着素材カードを生成
function createLatestCard(item) {
  const div = document.createElement("div");
  div.className = "col-lg-2 col-md-4 col-6";
  
  const a = document.createElement("a");
  a.className = "card h-100 text-decoration-none text-body border-0 shadow-sm";
  a.href = `items/${item.slug}/`;
  a.innerHTML = `
    <div class="position-relative">
      <img class="card-img-top object-fit-cover" loading="lazy" src="${item.thumb}" alt="${item.title}" style="height: 160px;">
      <div class="position-absolute top-0 start-0 m-2">
        <span class="badge bg-success">NEW</span>
      </div>
      <div class="position-absolute top-0 end-0 m-2">
        <span class="badge bg-primary">${item.category}</span>
      </div>
    </div>
    <div class="card-body p-3">
      <h6 class="card-title mb-1 small">${item.title}</h6>
      <div class="d-flex flex-wrap gap-1 mb-2">
        ${item.tags.slice(0, 2).map(tag => `<span class="badge bg-light text-dark small">${tag}</span>`).join('')}
        ${item.tags.length > 2 ? `<span class="badge bg-light text-muted small">+${item.tags.length - 2}</span>` : ''}
      </div>
      <small class="text-muted">${item.width || "?"}×${item.height || "?"}</small>
    </div>
  `;
  
  // ホバー効果
  a.onmouseenter = () => {
    a.classList.add("shadow");
    a.style.transform = "translateY(-2px)";
  };
  a.onmouseleave = () => {
    a.classList.remove("shadow");
    a.style.transform = "translateY(0)";
  };
  
  div.appendChild(a);
  return div;
}

// 新着素材を表示
function renderLatestItems(items) {
  const container = document.getElementById("latestItems");
  
  // 最新の5つの素材を取得（仮想的に最新順とする）
  const latestItems = items.slice(-5).reverse();
  
  container.innerHTML = "";
  latestItems.forEach(item => {
    container.appendChild(createLatestCard(item));
  });
}
(async function(){
  const res = await fetch("assets.json");
  const data = await res.json();
  let items = data.items || [];

  const cats = Array.from(new Set(items.map(x => x.category))).sort();
  const tags = Array.from(new Set(items.flatMap(x => x.tags))).sort();

  // タグの使用頻度を計算
  const tagFreq = {};
  items.forEach(item => {
    item.tags.forEach(tag => {
      tagFreq[tag] = (tagFreq[tag] || 0) + 1;
    });
  });

  // 統計情報を更新
  document.getElementById("totalItems").textContent = items.length;
  document.getElementById("totalCategories").textContent = cats.length;
  document.getElementById("totalTags").textContent = tags.length;

  // 新着素材を表示
  renderLatestItems(items);

  // URLパラメータからタグやカテゴリを読み取り
  const urlParams = new URLSearchParams(window.location.search);
  const tagParam = urlParams.get('tag');
  const categoryParam = urlParams.get('category');
  
  // パラメータに基づいて初期設定
  if (categoryParam) {
    document.getElementById("cat").value = categoryParam;
  }

  // フッターのカテゴリを追加
  const footerCats = document.getElementById("footerCategories");
  cats.slice(0, 8).forEach(cat => {
    const badge = document.createElement("span");
    badge.className = "badge bg-secondary text-decoration-none";
    badge.textContent = cat;
    badge.style.cursor = "pointer";
    badge.onclick = () => {
      document.getElementById("cat").value = cat;
      document.querySelector('main').scrollIntoView({ behavior: 'smooth' });
      render();
    };
    footerCats.appendChild(badge);
  });

  // フッターのタグ一覧を追加
  const footerTags = document.getElementById("footerTags");
  
  // タグを頻度順でソートして上位30個を表示
  const sortedFooterTags = tags.sort((a, b) => {
    const freqA = tagFreq[a] || 0;
    const freqB = tagFreq[b] || 0;
    return freqB - freqA;
  }).slice(0, 30);
  
  sortedFooterTags.forEach(tag => {
    const tagLink = document.createElement("span");
    tagLink.className = "badge bg-outline-light text-light border border-secondary";
    tagLink.style.cursor = "pointer";
    tagLink.textContent = tag;
    tagLink.title = `「${tag}」で絞り込み検索`;
    
    tagLink.onclick = () => {
      // メインのタグボタンをアクティブにする
      const mainTagBtn = document.querySelector(`[data-tag="${tag}"]`);
      if (mainTagBtn && !mainTagBtn.classList.contains("active")) {
        mainTagBtn.click(); // タグボタンのクリックイベントを発火
      }
      
      // 検索セクションまでスクロール
      document.querySelector('main').scrollIntoView({ behavior: 'smooth' });
    };
    
    tagLink.onmouseenter = () => {
      tagLink.classList.remove("bg-outline-light");
      tagLink.classList.add("bg-light", "text-dark");
    };
    
    tagLink.onmouseleave = () => {
      tagLink.classList.remove("bg-light", "text-dark");
      tagLink.classList.add("bg-outline-light");
    };
    
    footerTags.appendChild(tagLink);
  });

  const catSel = document.getElementById("cat");
  cats.forEach(c => { const o=document.createElement("option"); o.value=c; o.textContent=c; catSel.appendChild(o); });

  const tagbar = document.getElementById("tagbar");
  const activeTags = new Set();
  
  // タグを頻度順でソート
  const sortedTags = tags.sort((a, b) => tagFreq[b] - tagFreq[a]);
  
  sortedTags.forEach(t => {
    const b=document.createElement("button");
    const freq = tagFreq[t];
    const maxFreq = Math.max(...Object.values(tagFreq));
    const freqLevel = Math.min(5, Math.ceil((freq / maxFreq) * 5));
    
    // Bootstrapのサイズクラスを使用
    let sizeClass = "btn-sm";
    if (freqLevel >= 4) sizeClass = "";  // 通常サイズ
    else if (freqLevel >= 3) sizeClass = "btn-sm";
    else sizeClass = "btn-sm";
    
    b.type="button"; 
    b.className=`btn btn-outline-secondary ${sizeClass} me-1 mb-1`; 
    b.textContent=`${t} (${freq})`;
    b.title=`${freq}個のアイテムにこのタグが使用されています`;
    b.setAttribute("data-tag", t);
    b.onclick=()=>{ 
      b.classList.toggle("active");
      if (b.classList.contains("active")) {
        b.classList.remove("btn-outline-secondary");
        b.classList.add("btn-secondary");
      } else {
        b.classList.remove("btn-secondary");
        b.classList.add("btn-outline-secondary");
      }
      activeTags.has(t) ? activeTags.delete(t) : activeTags.add(t); 
      updateSelectedTags();
      render(); 
    };
    tagbar.appendChild(b);
  });

  // URLパラメータのタグを自動選択
  if (tagParam) {
    const tagBtn = document.querySelector(`[data-tag="${tagParam}"]`);
    if (tagBtn) {
      tagBtn.click(); // タグボタンをクリックして選択状態にする
      // メインの検索エリアまでスクロール
      setTimeout(() => {
        document.querySelector('main').scrollIntoView({ behavior: 'smooth' });
      }, 100);
    }
  }

  const q = document.getElementById("q");
  const sortSel = document.getElementById("sort");
  const clearTagsBtn = document.getElementById("clearTags");
  
  q.addEventListener("input", render);
  catSel.addEventListener("change", render);
  sortSel.addEventListener("change", render);
  
  // タグクリア機能
  clearTagsBtn.addEventListener("click", () => {
    activeTags.clear();
    document.querySelectorAll("[data-tag]").forEach(tag => {
      tag.classList.remove("active", "btn-secondary");
      tag.classList.add("btn-outline-secondary");
    });
    updateSelectedTags();
    render();
  });

  function sortItems(arr){
    const v = sortSel.value;
    if (v === "wdesc") return arr.sort((a,b) => (b.width||0)-(a.width||0));
    if (v === "wasc") return arr.sort((a,b) => (a.width||0)-(b.width||0));
    return arr.sort((a,b) => a.title.localeCompare(b.title));
  }

  // 選択されたタグの表示を更新
  function updateSelectedTags() {
    const selectedDiv = document.getElementById("selectedTags");
    const listDiv = document.getElementById("selectedTagsList");
    const statsDiv = document.getElementById("tagStats");
    
    if (activeTags.size === 0) {
      selectedDiv.style.display = "none";
    } else {
      selectedDiv.style.display = "block";
      listDiv.innerHTML = "";
      
      [...activeTags].forEach(tag => {
        const badge = document.createElement("span");
        badge.className = "badge bg-primary";
        badge.innerHTML = `${tag} <button type="button" class="btn-close btn-close-white" style="font-size:0.7em;" aria-label="Remove ${tag}"></button>`;
        badge.querySelector(".btn-close").onclick = (e) => {
          e.preventDefault();
          activeTags.delete(tag);
          const tagBtn = document.querySelector(`[data-tag="${tag}"]`);
          if (tagBtn) {
            tagBtn.classList.remove("active", "btn-secondary");
            tagBtn.classList.add("btn-outline-secondary");
          }
          updateSelectedTags();
          render();
        };
        listDiv.appendChild(badge);
      });
    }
    
    // タグ統計情報
    const totalTags = tags.length;
    const usedTags = activeTags.size;
    statsDiv.textContent = usedTags > 0 ? 
      `${usedTags}/${totalTags}個のタグで絞り込み中` : 
      `全${totalTags}個のタグ`;
  }

  function match(x){
    const kw = q.value.trim().toLowerCase();
    const kwok = !kw || [x.title, x.category, ...(x.tags||[])].join(" ").toLowerCase().includes(kw);
    const catok = !catSel.value || x.category === catSel.value;
    const tagok = activeTags.size===0 || [...activeTags].every(t => x.tags.includes(t));
    return kwok && catok && tagok;
  }

  function card(t){
    const div = document.createElement("div");
    div.className = "col-xl-3 col-lg-4 col-md-6";
    const a = document.createElement("a");
    a.className = "card h-100 text-decoration-none text-body shadow-sm";
    a.href = `items/${t.slug}/`;
    a.innerHTML = `
      <div class="position-relative">
        <img class="card-img-top object-fit-cover" loading="lazy" src="${t.thumb}" alt="${t.title}" style="height: 220px;">
        <div class="position-absolute top-0 end-0 m-2">
          <span class="badge bg-primary">${t.category}</span>
        </div>
        <div class="position-absolute bottom-0 start-0 end-0 bg-gradient" style="background: linear-gradient(transparent, rgba(0,0,0,0.7)); height: 60px;"></div>
        <div class="position-absolute bottom-0 start-0 p-2">
          <small class="text-white fw-semibold">${t.width || "?"}×${t.height || "?"}</small>
        </div>
      </div>
      <div class="card-body">
        <h6 class="card-title mb-2">${t.title}</h6>
        <div class="d-flex flex-wrap gap-1 mb-2">
          ${t.tags.slice(0, 3).map(tag => `<span class="badge bg-light text-dark">${tag}</span>`).join('')}
          ${t.tags.length > 3 ? `<span class="badge bg-light text-muted">+${t.tags.length - 3}</span>` : ''}
        </div>
        <div class="d-flex justify-content-between align-items-center">
          <small class="text-muted">${t.license}</small>
          <small class="text-primary fw-semibold">詳細 →</small>
        </div>
      </div>`;
    
    // ホバー効果
    a.onmouseenter = () => a.classList.add("shadow");
    a.onmouseleave = () => a.classList.remove("shadow");
    
    div.appendChild(a);
    return div;
  }

  function render(){
    const matched = items.filter(match);
    const sorted = sortItems([...matched]);
    
    const grid = document.getElementById("grid");
    grid.innerHTML = "";
    sorted.forEach(x => grid.appendChild(card(x)));
    
    // 検索結果の統計表示
    const resultCount = matched.length;
    const totalCount = items.length;
    document.title = resultCount < totalCount ? 
      `${resultCount}件の結果 - フリー画像素材集` : 
      "フリー画像素材集 | ゲーム開発向け高品質素材";
      
    // 結果情報の表示
    const resultInfo = document.getElementById("resultInfo");
    
    if (resultCount < totalCount) {
      const filters = [];
      if (q.value.trim()) filters.push(`キーワード「${q.value.trim()}」`);
      if (catSel.value) filters.push(`カテゴリ「${catSel.value}」`);
      if (activeTags.size > 0) filters.push(`タグ「${[...activeTags].join(", ")}」`);
      
      resultInfo.innerHTML = `
        <div class="d-flex align-items-center">
          <i class="bi bi-funnel me-2"></i>
          <strong>${resultCount}件</strong> の結果が見つかりました（全${totalCount}件中）
          ${filters.length > 0 ? `<br><small class="ms-4">絞り込み条件: ${filters.join(" + ")}</small>` : ""}
        </div>
      `;
      resultInfo.style.display = "block";
    } else {
      resultInfo.style.display = "none";
    }
    
    updateSelectedTags();
  }
  render();
  updateSelectedTags(); // 初期状態のタグ統計を表示
})();
</script>
</body>
</html>
