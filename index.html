<!-- index.htmlï¼ˆå·®åˆ†ã®ãƒã‚¤ãƒ³ãƒˆï¼šã‚«ãƒ¼ãƒ‰ãŒ detail ã¸é£›ã¶ãƒ»DLãƒœã‚¿ãƒ³ã¯å‰Šé™¤ï¼‰ -->
<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ãƒ•ãƒªãƒ¼ç”»åƒç´ æé›† | ã‚²ãƒ¼ãƒ é–‹ç™ºå‘ã‘é«˜å“è³ªç´ æ</title>
  <meta name="description" content="ã‚²ãƒ¼ãƒ é–‹ç™ºã«æœ€é©ãªãƒ•ãƒªãƒ¼ç”»åƒç´ æé›†ã€‚UIã€èƒŒæ™¯ã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãªã©è±Šå¯Œãªã‚«ãƒ†ã‚´ãƒªã®é«˜å“è³ªç´ æã‚’ç„¡æ–™ã§æä¾›ã€‚å•†ç”¨åˆ©ç”¨å¯èƒ½ã§å³ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½ã§ã™ã€‚">
  <meta name="keywords" content="ãƒ•ãƒªãƒ¼ç´ æ,ã‚²ãƒ¼ãƒ ç´ æ,ç”»åƒç´ æ,UIç´ æ,èƒŒæ™¯ç´ æ,ç„¡æ–™ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰,å•†ç”¨åˆ©ç”¨å¯èƒ½">
  <meta name="author" content="Free Game Materials">
  <meta property="og:title" content="ãƒ•ãƒªãƒ¼ç”»åƒç´ æé›† | ã‚²ãƒ¼ãƒ é–‹ç™ºå‘ã‘é«˜å“è³ªç´ æ">
  <meta property="og:description" content="ã‚²ãƒ¼ãƒ é–‹ç™ºã«æœ€é©ãªãƒ•ãƒªãƒ¼ç”»åƒç´ æé›†ã€‚UIã€èƒŒæ™¯ã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãªã©è±Šå¯Œãªã‚«ãƒ†ã‚´ãƒªã®é«˜å“è³ªç´ æã‚’ç„¡æ–™ã§æä¾›ã€‚">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://yohyama0216.github.io/free-image-material/">
  <meta property="og:image" content="https://yohyama0216.github.io/free-image-material/assets/og-image.jpg">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="ãƒ•ãƒªãƒ¼ç”»åƒç´ æé›† | ã‚²ãƒ¼ãƒ é–‹ç™ºå‘ã‘é«˜å“è³ªç´ æ">
  <meta name="twitter:description" content="ã‚²ãƒ¼ãƒ é–‹ç™ºã«æœ€é©ãªãƒ•ãƒªãƒ¼ç”»åƒç´ æé›†ã€‚UIã€èƒŒæ™¯ã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãªã©è±Šå¯Œãªã‚«ãƒ†ã‚´ãƒªã®é«˜å“è³ªç´ æã‚’ç„¡æ–™ã§æä¾›ã€‚">
  <meta name="twitter:image" content="https://yohyama0216.github.io/free-image-material/assets/og-image.jpg">
  <link rel="canonical" href="https://yohyama0216.github.io/free-image-material/">
  <link rel="icon" href="data:," />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>
<body>
<header class="border-bottom">
  <div class="container">
    <h1 class="h2 my-3">Free Game Materials</h1>
    <div class="row g-2 mb-3">
      <div class="col-md-4">
        <input id="q" type="search" class="form-control" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ï¼ˆä¾‹ï¼šsky, ui, grassï¼‰">
      </div>
      <div class="col-md-3">
        <select id="cat" class="form-select">
          <option value="">ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒª</option>
        </select>
      </div>
      <div class="col-md-3">
        <select id="sort" class="form-select">
          <option value="title">ä¸¦ã³æ›¿ãˆï¼šã‚¿ã‚¤ãƒˆãƒ«</option>
          <option value="wdesc">ä¸¦ã³æ›¿ãˆï¼šæ¨ªå¹…ï¼ˆå¤§â†’å°ï¼‰</option>
          <option value="wasc">ä¸¦ã³æ›¿ãˆï¼šæ¨ªå¹…ï¼ˆå°â†’å¤§ï¼‰</option>
        </select>
      </div>
      <div class="col-md-2">
        <button id="clearTags" class="btn btn-outline-danger w-100" title="é¸æŠä¸­ã®ã‚¿ã‚°ã‚’ã‚¯ãƒªã‚¢">
          <span>ğŸ·ï¸</span> ã‚¯ãƒªã‚¢
        </button>
      </div>
    </div>
    <div class="mb-3">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h6 class="mb-0">ã‚¿ã‚°ã§çµã‚Šè¾¼ã¿ï¼š</h6>
        <small id="tagStats" class="text-muted"></small>
      </div>
      <div id="tagbar" class="d-flex flex-wrap gap-2"></div>
      <div id="selectedTags" class="mt-2" style="display: none;">
        <small class="text-muted">é¸æŠä¸­ï¼š</small>
        <div id="selectedTagsList" class="d-inline-flex flex-wrap gap-1 ms-2"></div>
      </div>
    </div>
  </div>
</header>

<main>
  <div class="container">
    <div id="grid" class="row g-3"></div>
  </div>
</main>

<footer class="border-top mt-4">
  <div class="container py-3">
    <small class="text-muted">Â© 2025 Free Game Materials</small>
  </div>
</footer>

<script>
(async function(){
  const res = await fetch("assets.json");
  const data = await res.json();
  let items = data.items || [];

  const cats = Array.from(new Set(items.map(x => x.category))).sort();
  const tags = Array.from(new Set(items.flatMap(x => x.tags))).sort();

  // ã‚¿ã‚°ã®ä½¿ç”¨é »åº¦ã‚’è¨ˆç®—
  const tagFreq = {};
  items.forEach(item => {
    item.tags.forEach(tag => {
      tagFreq[tag] = (tagFreq[tag] || 0) + 1;
    });
  });

  const catSel = document.getElementById("cat");
  cats.forEach(c => { const o=document.createElement("option"); o.value=c; o.textContent=c; catSel.appendChild(o); });

  const tagbar = document.getElementById("tagbar");
  const activeTags = new Set();
  
  // ã‚¿ã‚°ã‚’é »åº¦é †ã§ã‚½ãƒ¼ãƒˆ
  const sortedTags = tags.sort((a, b) => tagFreq[b] - tagFreq[a]);
  
  sortedTags.forEach(t => {
    const b=document.createElement("button");
    const freq = tagFreq[t];
    const maxFreq = Math.max(...Object.values(tagFreq));
    const freqLevel = Math.min(5, Math.ceil((freq / maxFreq) * 5));
    
    // Bootstrapã®ã‚µã‚¤ã‚ºã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨
    let sizeClass = "btn-sm";
    if (freqLevel >= 4) sizeClass = "";  // é€šå¸¸ã‚µã‚¤ã‚º
    else if (freqLevel >= 3) sizeClass = "btn-sm";
    else sizeClass = "btn-sm";
    
    b.type="button"; 
    b.className=`btn btn-outline-secondary ${sizeClass} me-1 mb-1`; 
    b.textContent=`${t} (${freq})`;
    b.title=`${freq}å€‹ã®ã‚¢ã‚¤ãƒ†ãƒ ã«ã“ã®ã‚¿ã‚°ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™`;
    b.setAttribute("data-tag", t);
    b.onclick=()=>{ 
      b.classList.toggle("active");
      if (b.classList.contains("active")) {
        b.classList.remove("btn-outline-secondary");
        b.classList.add("btn-secondary");
      } else {
        b.classList.remove("btn-secondary");
        b.classList.add("btn-outline-secondary");
      }
      activeTags.has(t) ? activeTags.delete(t) : activeTags.add(t); 
      updateSelectedTags();
      render(); 
    };
    tagbar.appendChild(b);
  });

  const q = document.getElementById("q");
  const sortSel = document.getElementById("sort");
  const clearTagsBtn = document.getElementById("clearTags");
  
  q.addEventListener("input", render);
  catSel.addEventListener("change", render);
  sortSel.addEventListener("change", render);
  
  // ã‚¿ã‚°ã‚¯ãƒªã‚¢æ©Ÿèƒ½
  clearTagsBtn.addEventListener("click", () => {
    activeTags.clear();
    document.querySelectorAll("[data-tag]").forEach(tag => {
      tag.classList.remove("active", "btn-secondary");
      tag.classList.add("btn-outline-secondary");
    });
    updateSelectedTags();
    render();
  });

  function sortItems(arr){
    const v = sortSel.value;
    if (v === "wdesc") return arr.sort((a,b) => (b.width||0)-(a.width||0));
    if (v === "wasc") return arr.sort((a,b) => (a.width||0)-(b.width||0));
    return arr.sort((a,b) => a.title.localeCompare(b.title));
  }

  // é¸æŠã•ã‚ŒãŸã‚¿ã‚°ã®è¡¨ç¤ºã‚’æ›´æ–°
  function updateSelectedTags() {
    const selectedDiv = document.getElementById("selectedTags");
    const listDiv = document.getElementById("selectedTagsList");
    const statsDiv = document.getElementById("tagStats");
    
    if (activeTags.size === 0) {
      selectedDiv.style.display = "none";
    } else {
      selectedDiv.style.display = "block";
      listDiv.innerHTML = "";
      
      [...activeTags].forEach(tag => {
        const badge = document.createElement("span");
        badge.className = "badge bg-primary";
        badge.innerHTML = `${tag} <button type="button" class="btn-close btn-close-white" style="font-size:0.7em;" aria-label="Remove ${tag}"></button>`;
        badge.querySelector(".btn-close").onclick = (e) => {
          e.preventDefault();
          activeTags.delete(tag);
          const tagBtn = document.querySelector(`[data-tag="${tag}"]`);
          if (tagBtn) {
            tagBtn.classList.remove("active", "btn-secondary");
            tagBtn.classList.add("btn-outline-secondary");
          }
          updateSelectedTags();
          render();
        };
        listDiv.appendChild(badge);
      });
    }
    
    // ã‚¿ã‚°çµ±è¨ˆæƒ…å ±
    const totalTags = tags.length;
    const usedTags = activeTags.size;
    statsDiv.textContent = usedTags > 0 ? 
      `${usedTags}/${totalTags}å€‹ã®ã‚¿ã‚°ã§çµã‚Šè¾¼ã¿ä¸­` : 
      `å…¨${totalTags}å€‹ã®ã‚¿ã‚°`;
  }

  function match(x){
    const kw = q.value.trim().toLowerCase();
    const kwok = !kw || [x.title, x.category, ...(x.tags||[])].join(" ").toLowerCase().includes(kw);
    const catok = !catSel.value || x.category === catSel.value;
    const tagok = activeTags.size===0 || [...activeTags].every(t => x.tags.includes(t));
    return kwok && catok && tagok;
  }

  function card(t){
    const div = document.createElement("div");
    div.className = "col-md-4 col-lg-3";
    const a = document.createElement("a");
    a.className = "card h-100 text-decoration-none text-body";
    a.href = `items/${t.slug}/`;     // â† è©³ç´°ãƒšãƒ¼ã‚¸ã¸
    a.innerHTML = `
      <img class="card-img-top object-fit-cover" loading="lazy" src="${t.thumb}" alt="${t.title} - ${t.category}ç´ æç”»åƒ" style="height: 200px;">
      <div class="card-body">
        <h5 class="card-title">${t.title}</h5>
        <p class="card-text">
          <small class="text-muted">${t.category} Â· ${t.tags.join(", ")}</small><br>
          <small class="text-muted">${t.width || "?"}Ã—${t.height || "?"} Â· ${t.license}</small>
        </p>
      </div>`;
    div.appendChild(a);
    return div;
  }

  function render(){
    const matched = items.filter(match);
    const sorted = sortItems([...matched]);
    
    const grid = document.getElementById("grid");
    grid.innerHTML = "";
    sorted.forEach(x => grid.appendChild(card(x)));
    
    // æ¤œç´¢çµæœã®çµ±è¨ˆè¡¨ç¤º
    const resultCount = matched.length;
    const totalCount = items.length;
    document.title = resultCount < totalCount ? 
      `${resultCount}ä»¶ã®çµæœ - ãƒ•ãƒªãƒ¼ç”»åƒç´ æé›†` : 
      "ãƒ•ãƒªãƒ¼ç”»åƒç´ æé›† | ã‚²ãƒ¼ãƒ é–‹ç™ºå‘ã‘é«˜å“è³ªç´ æ";
      
    // ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã«çµæœæ•°è¡¨ç¤º
    let resultInfo = document.getElementById("resultInfo");
    if (!resultInfo) {
      resultInfo = document.createElement("div");
      resultInfo.id = "resultInfo";
      resultInfo.className = "alert alert-info mb-3";
      grid.parentNode.insertBefore(resultInfo, grid);
    }
    
    if (resultCount < totalCount) {
      const filters = [];
      if (q.value.trim()) filters.push(`ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€Œ${q.value.trim()}ã€`);
      if (catSel.value) filters.push(`ã‚«ãƒ†ã‚´ãƒªã€Œ${catSel.value}ã€`);
      if (activeTags.size > 0) filters.push(`ã‚¿ã‚°ã€Œ${[...activeTags].join(", ")}ã€`);
      
      resultInfo.innerHTML = `
        <strong>${resultCount}ä»¶</strong> ã®çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼ˆå…¨${totalCount}ä»¶ä¸­ï¼‰
        ${filters.length > 0 ? `<br><small>çµã‚Šè¾¼ã¿æ¡ä»¶: ${filters.join(" + ")}</small>` : ""}
      `;
      resultInfo.style.display = "block";
    } else {
      resultInfo.style.display = "none";
    }
    
    updateSelectedTags();
  }
  render();
  updateSelectedTags(); // åˆæœŸçŠ¶æ…‹ã®ã‚¿ã‚°çµ±è¨ˆã‚’è¡¨ç¤º
})();
</script>
</body>
</html>
