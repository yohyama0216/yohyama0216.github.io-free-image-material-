<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ã‚¿ã‚°ä¸€è¦§ - ãƒ•ãƒªãƒ¼ç”»åƒç´ æé›†</title>
  <meta name="description" content="ãƒ•ãƒªãƒ¼ç”»åƒç´ æã®ã‚¿ã‚°ä¸€è¦§ãƒšãƒ¼ã‚¸ã€‚ã‚«ãƒ†ã‚´ãƒªåˆ¥ã€ä½¿ç”¨é »åº¦åˆ¥ã«ã‚¿ã‚°ã‚’æ•´ç†ã—ã¦è¡¨ç¤ºã€‚åŠ¹ç‡çš„ã«ç´ æã‚’æ¢ã™ã“ã¨ãŒã§ãã¾ã™ã€‚">
  <meta name="keywords" content="ã‚¿ã‚°ä¸€è¦§,ãƒ•ãƒªãƒ¼ç´ æ,ã‚²ãƒ¼ãƒ ç´ æ,æ¤œç´¢,ã‚«ãƒ†ã‚´ãƒª,åˆ†é¡">
  <meta name="author" content="Free Game Materials">
  <meta property="og:title" content="ã‚¿ã‚°ä¸€è¦§ - ãƒ•ãƒªãƒ¼ç”»åƒç´ æé›†">
  <meta property="og:description" content="ãƒ•ãƒªãƒ¼ç”»åƒç´ æã®ã‚¿ã‚°ä¸€è¦§ãƒšãƒ¼ã‚¸ã€‚ã‚«ãƒ†ã‚´ãƒªåˆ¥ã€ä½¿ç”¨é »åº¦åˆ¥ã«ã‚¿ã‚°ã‚’æ•´ç†ã—ã¦è¡¨ç¤ºã€‚">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://yohyama0216.github.io/free-image-material/tags.html">
  <meta property="og:image" content="https://yohyama0216.github.io/free-image-material/assets/og-image.jpg">
  <link rel="canonical" href="https://yohyama0216.github.io/free-image-material/tags.html">
  <link rel="icon" href="data:," />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>
<body>
<!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
  <div class="container">
    <a class="navbar-brand fw-bold" href="./">
      ğŸ® Free Game Materials
    </a>
    <div class="navbar-nav ms-auto">
      <a class="nav-link" href="./">â† ç´ æä¸€è¦§ã«æˆ»ã‚‹</a>
    </div>
  </div>
</nav>

<!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
<section class="bg-light py-4">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-8">
        <h1 class="h2 fw-bold mb-2">ğŸ·ï¸ ã‚¿ã‚°ä¸€è¦§</h1>
        <p class="text-muted mb-0">ç´ æã‚’åŠ¹ç‡çš„ã«è¦‹ã¤ã‘ã‚‹ãŸã‚ã®ã‚¿ã‚°åˆ†é¡ä¸€è¦§ã§ã™ã€‚</p>
      </div>
      <div class="col-md-4 text-end">
        <div class="btn-group" role="group">
          <button type="button" class="btn btn-outline-primary active" id="viewFrequency" onclick="changeView('frequency')">
            ä½¿ç”¨é »åº¦é †
          </button>
          <button type="button" class="btn btn-outline-primary" id="viewAlphabetical" onclick="changeView('alphabetical')">
            ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †
          </button>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- çµ±è¨ˆæƒ…å ± -->
<section class="py-3 border-bottom">
  <div class="container">
    <div class="row text-center">
      <div class="col-md-3">
        <div class="h5 fw-bold text-primary" id="totalTagsCount">-</div>
        <small class="text-muted">ç·ã‚¿ã‚°æ•°</small>
      </div>
      <div class="col-md-3">
        <div class="h5 fw-bold text-primary" id="totalItemsCount">-</div>
        <small class="text-muted">ç·ç´ ææ•°</small>
      </div>
      <div class="col-md-3">
        <div class="h5 fw-bold text-primary" id="avgTagsPerItem">-</div>
        <small class="text-muted">å¹³å‡ã‚¿ã‚°æ•°/ç´ æ</small>
      </div>
      <div class="col-md-3">
        <div class="h5 fw-bold text-primary" id="mostPopularTag">-</div>
        <small class="text-muted">æœ€äººæ°—ã‚¿ã‚°</small>
      </div>
    </div>
  </div>
</section>

<!-- æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
<section class="py-4">
  <div class="container">
    <div class="row g-3 mb-4">
      <div class="col-md-6">
        <label class="form-label fw-semibold">ğŸ” ã‚¿ã‚°ã‚’æ¤œç´¢</label>
        <input id="tagSearch" type="search" class="form-control" placeholder="ã‚¿ã‚°åã‚’å…¥åŠ›ã—ã¦æ¤œç´¢...">
      </div>
      <div class="col-md-3">
        <label class="form-label fw-semibold">ğŸ“ ã‚«ãƒ†ã‚´ãƒªã§çµã‚Šè¾¼ã¿</label>
        <select id="categoryFilter" class="form-select">
          <option value="">ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒª</option>
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label fw-semibold">ğŸ“Š æœ€å°ä½¿ç”¨æ•°</label>
        <select id="minUsageFilter" class="form-select">
          <option value="1">1å›ä»¥ä¸Š</option>
          <option value="2">2å›ä»¥ä¸Š</option>
          <option value="3">3å›ä»¥ä¸Š</option>
          <option value="5">5å›ä»¥ä¸Š</option>
          <option value="10">10å›ä»¥ä¸Š</option>
        </select>
      </div>
    </div>
  </div>
</section>

<!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
<main class="py-4">
  <div class="container">
    <!-- ã‚¿ã‚°ã‚¯ãƒ©ã‚¦ãƒ‰è¡¨ç¤º -->
    <div class="card">
      <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
          <h5 class="mb-0">ã‚¿ã‚°ã‚¯ãƒ©ã‚¦ãƒ‰</h5>
          <small id="filteredTagCount" class="text-muted"></small>
        </div>
      </div>
      <div class="card-body">
        <div id="tagCloud" class="d-flex flex-wrap gap-2">
          <!-- ã‚¿ã‚°ãŒã“ã“ã«å‹•çš„ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
        </div>
      </div>
    </div>

    <!-- ã‚¿ã‚°ãƒªã‚¹ãƒˆè¡¨ç¤º -->
    <div class="card mt-4">
      <div class="card-header">
        <h5 class="mb-0">è©³ç´°ã‚¿ã‚°ãƒªã‚¹ãƒˆ</h5>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="table-light">
              <tr>
                <th>ã‚¿ã‚°å</th>
                <th>ä½¿ç”¨å›æ•°</th>
                <th>ã‚«ãƒ†ã‚´ãƒª</th>
                <th>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th>
              </tr>
            </thead>
            <tbody id="tagTableBody">
              <!-- ã‚¿ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ãŒã“ã“ã«å‹•çš„ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
<footer class="bg-dark text-white py-4 mt-5">
  <div class="container">
    <div class="row">
      <div class="col-md-6">
        <h5>Free Game Materials</h5>
        <p class="text-muted">ã‚²ãƒ¼ãƒ é–‹ç™ºã«æœ€é©ãªãƒ•ãƒªãƒ¼ç´ æã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚</p>
      </div>
      <div class="col-md-3">
        <h6>ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³</h6>
        <ul class="list-unstyled">
          <li><a href="./" class="text-light text-decoration-none">ç´ æä¸€è¦§</a></li>
          <li><a href="tags.html" class="text-light text-decoration-none">ã‚¿ã‚°ä¸€è¦§</a></li>
        </ul>
      </div>
      <div class="col-md-3">
        <h6>åˆ©ç”¨ã«ã¤ã„ã¦</h6>
        <ul class="list-unstyled">
          <li><small>âœ“ å•†ç”¨åˆ©ç”¨å¯èƒ½</small></li>
          <li><small>âœ“ ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆä¸è¦</small></li>
          <li><small>âœ“ åŠ å·¥ãƒ»æ”¹å¤‰OK</small></li>
        </ul>
      </div>
    </div>
    <hr class="my-3">
    <div class="text-center">
      <small class="text-muted">Â© 2025 Free Game Materials. All rights reserved.</small>
    </div>
  </div>
</footer>

<script>
let allTags = [];
let allItems = [];
let currentView = 'frequency';

// ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
(async function(){
  try {
    const res = await fetch("assets.json");
    const data = await res.json();
    allItems = data.items || [];
    
    // ã‚¿ã‚°çµ±è¨ˆã‚’è¨ˆç®—
    calculateTagStatistics();
    
    // åˆæœŸè¡¨ç¤º
    renderAll();
    
  } catch (error) {
    console.error('Failed to load data:', error);
  }
})();

// ã‚¿ã‚°çµ±è¨ˆã‚’è¨ˆç®—
function calculateTagStatistics() {
  const tagStats = {};
  const tagCategories = {};
  
  allItems.forEach(item => {
    item.tags.forEach(tag => {
      if (!tagStats[tag]) {
        tagStats[tag] = 0;
        tagCategories[tag] = new Set();
      }
      tagStats[tag]++;
      tagCategories[tag].add(item.category);
    });
  });
  
  // ã‚¿ã‚°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é…åˆ—ã‚’ä½œæˆ
  allTags = Object.keys(tagStats).map(tag => ({
    name: tag,
    count: tagStats[tag],
    categories: Array.from(tagCategories[tag])
  }));
  
  // çµ±è¨ˆæƒ…å ±ã‚’æ›´æ–°
  updateStatistics();
  
  // ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’è¨­å®š
  setupCategoryFilter();
}

// çµ±è¨ˆæƒ…å ±ã‚’æ›´æ–°
function updateStatistics() {
  const totalTags = allTags.length;
  const totalItems = allItems.length;
  const avgTags = totalItems > 0 ? (allItems.reduce((sum, item) => sum + item.tags.length, 0) / totalItems).toFixed(1) : 0;
  const mostPopular = allTags.length > 0 ? allTags.reduce((max, tag) => tag.count > max.count ? tag : max, allTags[0]).name : '-';
  
  document.getElementById('totalTagsCount').textContent = totalTags;
  document.getElementById('totalItemsCount').textContent = totalItems;
  document.getElementById('avgTagsPerItem').textContent = avgTags;
  document.getElementById('mostPopularTag').textContent = mostPopular;
}

// ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’è¨­å®š
function setupCategoryFilter() {
  const categories = Array.from(new Set(allItems.map(item => item.category))).sort();
  const select = document.getElementById('categoryFilter');
  
  categories.forEach(category => {
    const option = document.createElement('option');
    option.value = category;
    option.textContent = category;
    select.appendChild(option);
  });
}

// è¡¨ç¤ºæ–¹æ³•ã‚’å¤‰æ›´
function changeView(view) {
  currentView = view;
  
  // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
  document.getElementById('viewFrequency').classList.toggle('active', view === 'frequency');
  document.getElementById('viewAlphabetical').classList.toggle('active', view === 'alphabetical');
  
  renderAll();
}

// ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã•ã‚ŒãŸã‚¿ã‚°ã‚’å–å¾—
function getFilteredTags() {
  const searchTerm = document.getElementById('tagSearch').value.toLowerCase();
  const categoryFilter = document.getElementById('categoryFilter').value;
  const minUsage = parseInt(document.getElementById('minUsageFilter').value);
  
  let filtered = allTags.filter(tag => {
    // æ¤œç´¢èªã§ãƒ•ã‚£ãƒ«ã‚¿
    const matchesSearch = !searchTerm || tag.name.toLowerCase().includes(searchTerm);
    
    // ã‚«ãƒ†ã‚´ãƒªã§ãƒ•ã‚£ãƒ«ã‚¿
    const matchesCategory = !categoryFilter || tag.categories.includes(categoryFilter);
    
    // æœ€å°ä½¿ç”¨æ•°ã§ãƒ•ã‚£ãƒ«ã‚¿
    const matchesUsage = tag.count >= minUsage;
    
    return matchesSearch && matchesCategory && matchesUsage;
  });
  
  // ã‚½ãƒ¼ãƒˆ
  if (currentView === 'frequency') {
    filtered.sort((a, b) => b.count - a.count);
  } else {
    filtered.sort((a, b) => a.name.localeCompare(b.name));
  }
  
  return filtered;
}

// ã‚¿ã‚°ã‚¯ãƒ©ã‚¦ãƒ‰ã‚’æç”»
function renderTagCloud(tags) {
  const container = document.getElementById('tagCloud');
  
  if (tags.length === 0) {
    container.innerHTML = '<p class="text-muted text-center py-4">è©²å½“ã™ã‚‹ã‚¿ã‚°ãŒã‚ã‚Šã¾ã›ã‚“</p>';
    return;
  }
  
  const maxCount = Math.max(...tags.map(tag => tag.count));
  
  container.innerHTML = tags.map(tag => {
    const sizeLevel = Math.min(5, Math.ceil((tag.count / maxCount) * 5));
    let sizeClass = 'fs-6';
    let badgeClass = 'bg-secondary';
    
    if (sizeLevel >= 5) {
      sizeClass = 'fs-4';
      badgeClass = 'bg-primary';
    } else if (sizeLevel >= 4) {
      sizeClass = 'fs-5';
      badgeClass = 'bg-info';
    } else if (sizeLevel >= 3) {
      sizeClass = 'fs-6';
      badgeClass = 'bg-success';
    }
    
    return `
      <span class="badge ${badgeClass} ${sizeClass} me-2 mb-2" 
            style="cursor: pointer;"
            onclick="searchByTag('${tag.name}')"
            title="${tag.count}å€‹ã®ç´ æã§ä½¿ç”¨&#10;ã‚«ãƒ†ã‚´ãƒª: ${tag.categories.join(', ')}">
        ${tag.name} (${tag.count})
      </span>
    `;
  }).join('');
}

// ã‚¿ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æç”»
function renderTagTable(tags) {
  const tbody = document.getElementById('tagTableBody');
  
  if (tags.length === 0) {
    tbody.innerHTML = '<tr><td colspan="4" class="text-center text-muted py-4">è©²å½“ã™ã‚‹ã‚¿ã‚°ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
    return;
  }
  
  tbody.innerHTML = tags.map(tag => `
    <tr>
      <td>
        <span class="badge bg-light text-dark">${tag.name}</span>
      </td>
      <td>
        <span class="badge bg-primary">${tag.count}</span>
      </td>
      <td>
        <div class="d-flex flex-wrap gap-1">
          ${tag.categories.map(cat => `<span class="badge bg-outline-secondary small">${cat}</span>`).join('')}
        </div>
      </td>
      <td>
        <button class="btn btn-sm btn-outline-primary" onclick="searchByTag('${tag.name}')">
          ã“ã®ã‚¿ã‚°ã§æ¤œç´¢
        </button>
      </td>
    </tr>
  `).join('');
}

// ã™ã¹ã¦ã‚’æç”»
function renderAll() {
  const filteredTags = getFilteredTags();
  
  renderTagCloud(filteredTags);
  renderTagTable(filteredTags);
  
  document.getElementById('filteredTagCount').textContent = `${filteredTags.length}å€‹ã®ã‚¿ã‚°ã‚’è¡¨ç¤ºä¸­`;
}

// ã‚¿ã‚°ã§æ¤œç´¢ï¼ˆãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«ç§»å‹•ï¼‰
function searchByTag(tagName) {
  window.location.href = `./?tag=${encodeURIComponent(tagName)}`;
}

// ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
document.getElementById('tagSearch').addEventListener('input', renderAll);
document.getElementById('categoryFilter').addEventListener('change', renderAll);
document.getElementById('minUsageFilter').addEventListener('change', renderAll);
</script>
</body>
</html>
